# åŒæœŸå‹•ç”»ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼

è¤‡æ•°ã®ãƒ‡ãƒã‚¤ã‚¹é–“ã§å‹•ç”»ã‚’åŒæœŸå†ç”Ÿã™ã‚‹Next.jsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚

## ç‰¹å¾´

- ğŸ¬ **è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹åŒæœŸå†ç”Ÿ**: ã™ã¹ã¦ã®ãƒ‡ãƒã‚¤ã‚¹ã§åŒã˜ä½ç½®ã®å‹•ç”»ãŒå†ç”Ÿã•ã‚Œã¾ã™
- ğŸ”„ **è‡ªå‹•ãƒ«ãƒ¼ãƒ—**: å‹•ç”»ãŒçµ‚ã‚ã‚‹ã¨è‡ªå‹•çš„ã«ãƒ«ãƒ¼ãƒ—å†ç”Ÿã•ã‚Œã¾ã™
- âš¡ **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ**: Server-Sent Events (SSE)ã§1ç§’ã”ã¨ã«åŒæœŸ
- ğŸ“± **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³**: ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã€ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã€ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã«å¯¾å¿œ
- ğŸš€ **Vercelå¯¾å¿œ**: ç°¡å˜ã«ãƒ‡ãƒ—ãƒ­ã‚¤å¯èƒ½

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Next.js 16 (App Router)
- **è¨€èª**: TypeScript
- **ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°**: Tailwind CSS
- **åŒæœŸæ–¹å¼**: Server-Sent Events (SSE)
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: Amazon S3

## å‹•ä½œã®ä»•çµ„ã¿

### åŒæœŸãƒ¡ã‚«ãƒ‹ã‚ºãƒ 

1. **ã‚µãƒ¼ãƒãƒ¼å´** (`/app/api/sync/route.ts`)
   - ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã§ç¾åœ¨ã®å†ç”Ÿä½ç½®ã¨å†ç”ŸçŠ¶æ…‹ã‚’ç®¡ç†
   - Server-Sent Events (SSE)ã§1ç§’ã”ã¨ã«ã™ã¹ã¦ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«åŒæœŸãƒ‡ãƒ¼ã‚¿ã‚’é…ä¿¡
   - 100msã”ã¨ã«å†ç”Ÿä½ç½®ã‚’æ›´æ–°ï¼ˆç²¾å¯†ãªæ™‚åˆ»ç®¡ç†ï¼‰

2. **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´** (`/app/page.tsx`)
   - SSEã§ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰åŒæœŸãƒ‡ãƒ¼ã‚¿ã‚’å—ä¿¡
   - å‹•ç”»ã®å†ç”Ÿä½ç½®ãŒ1ç§’ä»¥ä¸Šã‚ºãƒ¬ã¦ã„ã‚‹å ´åˆã®ã¿èª¿æ•´ï¼ˆé »ç¹ãªèª¿æ•´ã‚’é˜²ãï¼‰
   - è‡ªå‹•å†ç”Ÿã€ãƒ«ãƒ¼ãƒ—å†ç”Ÿã«å¯¾å¿œ

### ãªãœServer-Sent Eventsã‚’é¸ã‚“ã ã‹ï¼Ÿ

- **Vercelå¯¾å¿œ**: WebSocketã¯Vercelã®ç„¡æ–™ãƒ—ãƒ©ãƒ³ã§åˆ¶é™ãŒã‚ã‚‹ãŒã€SSEã¯å•é¡Œãªãå‹•ä½œ
- **ã‚·ãƒ³ãƒ—ãƒ«**: ä¸€æ–¹å‘é€šä¿¡ï¼ˆã‚µãƒ¼ãƒãƒ¼â†’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã§ååˆ†ãªç”¨é€”
- **è»½é‡**: WebSocketã‚ˆã‚Šå®Ÿè£…ãŒç°¡å˜ã§ã€ã‚µãƒ¼ãƒãƒ¼è² è·ãŒä½ã„
- **ä¿¡é ¼æ€§**: è‡ªå‹•å†æ¥ç¶šæ©Ÿèƒ½ãŒæ¨™æº–è£…å‚™

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å‰ææ¡ä»¶

- Node.js 18ä»¥ä¸Š
- npm ã¾ãŸã¯ yarn

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
npm run dev
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:3000 ã‚’é–‹ãã¾ã™ã€‚

### å‹•ç”»URLã®å¤‰æ›´

`app/page.tsx` ã® `VIDEO_URL` ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ï¼š

```typescript
const VIDEO_URL = 'https://your-bucket.s3.amazonaws.com/your-video.mp4';
```

## ãƒ‡ãƒ—ãƒ­ã‚¤

### Vercelã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

1. GitHubãƒªãƒã‚¸ãƒˆãƒªã«ãƒ—ãƒƒã‚·ãƒ¥
2. [Vercel](https://vercel.com)ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
3. ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šï¼ˆè‡ªå‹•æ¤œå‡ºã•ã‚Œã¾ã™ï¼‰
4. ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ï¼

ã¾ãŸã¯ã€Vercel CLIã‚’ä½¿ç”¨ï¼š

```bash
npm install -g vercel
vercel
```

### ç’°å¢ƒå¤‰æ•°ï¼ˆå¿…è¦ãªå ´åˆï¼‰

Vercelãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ä»¥ä¸‹ã®ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã§ãã¾ã™ï¼š

- `VIDEO_URL`: å‹•ç”»ã®URLï¼ˆã‚³ãƒ¼ãƒ‰å†…ã«ç›´æ¥æ›¸ãå ´åˆã¯ä¸è¦ï¼‰

## ä½¿ã„æ–¹

1. ã‚¢ãƒ—ãƒªã‚’é–‹ã
2. è¤‡æ•°ã®ãƒ‡ãƒã‚¤ã‚¹ï¼ˆã‚¹ãƒãƒ›ã€ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã€PCï¼‰ã§åŒã˜URLã‚’é–‹ã
3. ã™ã¹ã¦ã®ãƒ‡ãƒã‚¤ã‚¹ã§åŒã˜ä½ç½®ã®å‹•ç”»ãŒå†ç”Ÿã•ã‚Œã‚‹
4. å‹•ç”»ãŒçµ‚ã‚ã‚‹ã¨è‡ªå‹•çš„ã«ãƒ«ãƒ¼ãƒ—å†ç”Ÿã•ã‚Œã‚‹

### åŒæœŸã®ç²¾åº¦

- **åŒæœŸé–“éš”**: 1ç§’ã”ã¨
- **èª¿æ•´é–¾å€¤**: 1ç§’ä»¥ä¸Šã®ã‚ºãƒ¬ã§èª¿æ•´
- **ç²¾åº¦**: Â±1ç§’ä»¥å†…

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å‹•ç”»ãŒè‡ªå‹•å†ç”Ÿã•ã‚Œãªã„ï¼ˆç‰¹ã«iOS Safariï¼‰

- ãƒ–ãƒ©ã‚¦ã‚¶ã®è‡ªå‹•å†ç”Ÿãƒãƒªã‚·ãƒ¼ã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œãŒå¿…è¦ãªå ´åˆãŒã‚ã‚Šã¾ã™
- ç¾åœ¨ã®å®Ÿè£…ã§ã¯ `muted` å±æ€§ã‚’ä»˜ã‘ã¦è‡ªå‹•å†ç”Ÿã‚’è¨±å¯ã—ã¦ã„ã¾ã™
- éŸ³å£°ä»˜ãã§å†ç”Ÿã—ãŸã„å ´åˆã¯ã€æœ€åˆã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå†ç”Ÿãƒœã‚¿ãƒ³ã‚’æŠ¼ã™å¿…è¦ãŒã‚ã‚Šã¾ã™

### è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹ã§åŒæœŸã—ãªã„

- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„
- ç”»é¢å³ä¸Šã®æ¥ç¶šçŠ¶æ…‹ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ãŒç·‘è‰²ï¼ˆåŒæœŸä¸­ï¼‰ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª
- ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª

### Vercelã§ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã€åŒæœŸãŒå‹•ä½œã—ãªã„

- `vercel.json` ã§ `/api/sync` ã® `maxDuration` ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- Vercelã®ç„¡æ–™ãƒ—ãƒ©ãƒ³ã§ã¯ã€SSEæ¥ç¶šãŒ60ç§’ã§åˆ‡æ–­ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™
  - Pro ãƒ—ãƒ©ãƒ³ã§ã¯æœ€å¤§300ç§’ã¾ã§å»¶é•·å¯èƒ½

## é–‹ç™º

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
video-sync-player/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ sync/
â”‚   â”‚       â””â”€â”€ route.ts      # SSEåŒæœŸAPI
â”‚   â”œâ”€â”€ globals.css           # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«
â”‚   â”œâ”€â”€ layout.tsx            # ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â””â”€â”€ page.tsx              # å‹•ç”»ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ãƒšãƒ¼ã‚¸
â”œâ”€â”€ public/                   # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ next.config.ts            # Next.jsè¨­å®š
â”œâ”€â”€ tailwind.config.ts        # Tailwind CSSè¨­å®š
â”œâ”€â”€ tsconfig.json             # TypeScriptè¨­å®š
â””â”€â”€ package.json              # ä¾å­˜é–¢ä¿‚
```

### ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

#### åŒæœŸé–“éš”ã®å¤‰æ›´

`app/api/sync/route.ts` ã® `setInterval` ã®å€¤ã‚’å¤‰æ›´ï¼š

```typescript
// 500msã”ã¨ã«åŒæœŸãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡
const interval = setInterval(() => {
  // ...
}, 500);
```

#### èª¿æ•´é–¾å€¤ã®å¤‰æ›´

`app/page.tsx` ã®é–¾å€¤ã‚’å¤‰æ›´ï¼š

```typescript
// 0.5ç§’ä»¥ä¸Šã®ã‚ºãƒ¬ã§èª¿æ•´
if (timeDiff > 0.5) {
  videoRef.current.currentTime = data.currentTime;
}
```

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT

## ä½œæˆè€…

é–‹ç™º: Claude Code
å‹•ç”»ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸: Amazon S3
ãƒ‡ãƒ—ãƒ­ã‚¤: Vercel
# oripla_signage_stream
